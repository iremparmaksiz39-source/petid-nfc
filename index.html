<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PatiLink - NFC Hayvan Takip Sistemi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK v9 -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, updateDoc, deleteDoc, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCZSnh9jWibR4a0Pc6RKBDYlGZNXP_Tiu8",
            authDomain: "petnfc-46178.firebaseapp.com",
            projectId: "petnfc-46178",
            storageBucket: "petnfc-46178.firebasestorage.app",
            messagingSenderId: "942096749783",
            appId: "1:942096749783:web:afcd7f8e4f4f109f3c4c92",
            measurementId: "G-XS8LXGR545"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Set persistence to keep user logged in
        setPersistence(auth, browserLocalPersistence).catch((error) => {
            console.log("Persistence setting failed:", error);
        });

        // Make Firebase available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseApp = app;
        
        // Firebase Auth functions
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseCreateUser = createUserWithEmailAndPassword;
        window.firebaseSignOut = signOut;
        window.firebaseAuthStateChanged = onAuthStateChanged;
        window.firebaseSetPersistence = setPersistence;
        window.firebaseBrowserLocalPersistence = browserLocalPersistence;
        
        // Firestore functions
        window.firestoreDoc = doc;
        window.firestoreSetDoc = setDoc;
        window.firestoreGetDoc = getDoc;
        window.firestoreCollection = collection;
        window.firestoreAddDoc = addDoc;
        window.firestoreUpdateDoc = updateDoc;
        window.firestoreDeleteDoc = deleteDoc;
        window.firestoreGetDocs = getDocs;
        window.firestoreQuery = query;
        window.firestoreWhere = where;
        window.firestoreOrderBy = orderBy;

        // Initialize auth state listener when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (window.initializeFirebaseAuth) {
                    window.initializeFirebaseAuth();
                }
            }, 100);
        });
    </script>
    
    <style>
        body {
            box-sizing: border-box;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .pet-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        .pet-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .call-button {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }
        .call-button:hover {
            background: linear-gradient(135deg, #38f9d7 0%, #43e97b 100%);
        }
        .emergency-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .modal {
            backdrop-filter: blur(10px);
        }
        .form-input {
            transition: all 0.3s ease;
        }
        .form-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .feature-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        .premium-badge {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .photo-upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .photo-upload-area:hover {
            border-color: #9333ea;
            background-color: #faf5ff;
        }
        .photo-preview {
            position: relative;
            overflow: hidden;
        }
        .photo-preview img {
            transition: transform 0.3s ease;
        }
        .photo-preview:hover img {
            transform: scale(1.05);
        }
        .delete-photo {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .photo-preview:hover .delete-photo {
            opacity: 1;
        }
        .social-input {
            padding-left: 40px;
        }
        .social-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }
        .qr-code {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .map-options {
            animation: slideDown 0.2s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .map-options button:hover {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="min-h-full bg-gray-50">
    <!-- Navigation -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-white">🐾 PatiLink</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="loginBtn" class="text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium cursor-pointer">Giriş Yap</button>
                    <button id="logoutBtn" class="text-white hover:text-gray-200 px-3 py-2 rounded-md text-sm font-medium hidden cursor-pointer">Çıkış Yap</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div id="mainContent" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <div id="welcomeSection" class="mb-12">
            <div class="text-center mb-16">
                <h2 class="text-5xl font-bold text-gray-900 mb-6">Hayvanınızı NFC ile Koruyun</h2>
                <p class="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">Tamamen ücretsiz! Kaybolduğunda hemen bulunabilsin. Tasmasına NFC tag takın, detaylı profilini oluşturun ve anlık takip edin.</p>
            </div>

            <!-- Features Grid -->
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16">
                <div class="feature-card p-6 rounded-xl shadow-lg text-center">
                    <div class="text-5xl mb-4">📱</div>
                    <h3 class="text-xl font-semibold mb-3">NFC Teknolojisi</h3>
                    <p class="text-gray-700">Telefon yaklaştırıldığında otomatik profil açılır</p>
                </div>
                <div class="feature-card p-6 rounded-xl shadow-lg text-center">
                    <div class="text-5xl mb-4">📊</div>
                    <h3 class="text-xl font-semibold mb-3">Anlık İstatistikler</h3>
                    <p class="text-gray-700">Kaç kişinin taradığını ve aradığını görün</p>
                </div>
                <div class="feature-card p-6 rounded-xl shadow-lg text-center">
                    <div class="text-5xl mb-4">📍</div>
                    <h3 class="text-xl font-semibold mb-3">Konum Takibi</h3>
                    <p class="text-gray-700">Hayvanınızı bulan kişilerin konumunu görün</p>
                </div>
                <div class="feature-card p-6 rounded-xl shadow-lg text-center">
                    <div class="text-5xl mb-4">🚨</div>
                    <h3 class="text-xl font-semibold mb-3">Acil Durum</h3>
                    <p class="text-gray-700">Tek tıkla arama ve yönlendirme</p>
                </div>
            </div>

            <!-- How It Works -->
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-16">
                <h3 class="text-3xl font-bold text-center mb-12">Nasıl Çalışır?</h3>
                <div class="grid md:grid-cols-5 gap-8">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-purple-600">1</span>
                        </div>
                        <h4 class="font-semibold mb-2">Üye Olun</h4>
                        <p class="text-sm text-gray-600">Hesap oluşturun</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-purple-600">2</span>
                        </div>
                        <h4 class="font-semibold mb-2">Profil Oluşturun</h4>
                        <p class="text-sm text-gray-600">Hayvan bilgilerini girin</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-purple-600">3</span>
                        </div>
                        <h4 class="font-semibold mb-2">NFC Tag İçin İletişim</h4>
                        <p class="text-sm text-gray-600">Biz NFC'yi programlayıp gönderiyoruz</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-purple-600">4</span>
                        </div>
                        <h4 class="font-semibold mb-2">Tasmasına Takın</h4>
                        <p class="text-sm text-gray-600">NFC tag'i hayvanın tasmasına takın</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <span class="text-2xl font-bold text-purple-600">5</span>
                        </div>
                        <h4 class="font-semibold mb-2">Güvende Olun</h4>
                        <p class="text-sm text-gray-600">Anlık takip edin</p>
                    </div>
                </div>
            </div>

            <!-- Pricing Plans -->
            <div class="text-center mb-16">
                <h3 class="text-3xl font-bold mb-8">Üyelik Planları</h3>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-8 border-2 border-green-500 relative">
                        <div class="premium-badge absolute -top-3 left-1/2 transform -translate-x-1/2 px-4 py-1 rounded-full text-sm font-semibold">
                            Tamamen Ücretsiz
                        </div>
                        <h4 class="text-xl font-semibold mb-4">Temel</h4>
                        <div class="text-3xl font-bold mb-4">₺0</div>
                        <ul class="text-left space-y-2 mb-6">
                            <li>✅ Sınırsız Hayvan Profili</li>
                            <li>✅ Tüm Özellikler</li>
                            <li>✅ NFC & QR Kod Desteği</li>
                            <li>✅ Detaylı İstatistikler</li>
                            <li>✅ Konum Takibi</li>
                            <li>✅ Fotoğraf Galerisi</li>
                            <li>✅ Sosyal Medya Linkleri</li>
                        </ul>
                        <button onclick="event.preventDefault(); showModal('loginModal')" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg">Giriş Yap</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-8">
                        <h4 class="text-xl font-semibold mb-4">NFC Tag Satışı</h4>
                        <div class="text-3xl font-bold mb-4">İletişime Geçin</div>
                        <ul class="text-left space-y-2 mb-6">
                            <li>🏷️ Hazır programlanmış NFC tag</li>
                            <li>📦 Ücretsiz kargo</li>
                            <li>🎨 Özel tasarım seçenekleri</li>
                            <li>💧 Su geçirmez</li>
                            <li>🔧 Kurulum desteği</li>
                            <li>📞 Teknik destek</li>
                        </ul>
                        <button onclick="event.preventDefault(); window.open('tel:05386694530', '_blank')" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-2 rounded-lg">📞 Sipariş Ver</button>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-8">
                        <h4 class="text-xl font-semibold mb-4">Pet Shop Ortaklığı</h4>
                        <div class="text-3xl font-bold mb-4">İletişim</div>
                        <ul class="text-left space-y-2 mb-6">
                            <li>🏪 Pet shop entegrasyonu</li>
                            <li>💰 Komisyon sistemi</li>
                            <li>📊 Satış raporları</li>
                            <li>🎯 Pazarlama desteği</li>
                            <li>📞 Özel müşteri hattı</li>
                            <li>🚀 Büyüme fırsatları</li>
                        </ul>
                        <button onclick="event.preventDefault(); window.open('tel:05386694530', '_blank')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg">📞 Ortaklık İçin Ara</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Dashboard (Hidden initially) -->
    <div id="userDashboard" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-bold text-gray-900">Hayvanlarım</h2>
            <div class="flex gap-4 flex-wrap">
                <button id="addPetBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium">
                    + Yeni Hayvan Ekle
                </button>
                <button id="editProfileBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium">
                    👤 Profili Düzenle
                </button>
            </div>
        </div>
        
        <div id="petsList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Pet cards will be added here -->
        </div>
    </div>

    <!-- Pet Profile View (Hidden initially) -->
    <div id="petProfileView" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden">
        <div id="petProfileContent">
            <!-- Pet profile content will be loaded here -->
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <div class="flex mb-6 bg-gray-100 rounded-lg p-1">
                <button type="button" id="loginTabBtn" class="flex-1 py-2 px-4 rounded-md text-sm font-medium bg-purple-600 text-white" onclick="switchLoginTab('login')">
                    Giriş Yap
                </button>
                <button type="button" id="registerTabBtn" class="flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-600" onclick="switchLoginTab('register')">
                    Kayıt Ol
                </button>
            </div>
            
            <!-- Login Form -->
            <div id="loginFormDiv">
                <h3 class="text-2xl font-bold mb-6 text-center">Giriş Yap</h3>
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">E-posta</label>
                        <input type="email" id="loginEmail" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Şifre</label>
                        <input type="password" id="loginPassword" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                    </div>
                    <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg">
                        Giriş Yap
                    </button>
                </form>
            </div>
            
            <!-- Register Form -->
            <div id="registerFormDiv" class="hidden">
                <h3 class="text-2xl font-bold mb-6 text-center">Kayıt Ol</h3>
                <form id="registerForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ad Soyad *</label>
                        <input type="text" id="registerName" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">E-posta *</label>
                        <input type="email" id="registerEmail" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Telefon Numarası *</label>
                        <input type="tel" id="registerPhone" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="05XX XXX XX XX" required pattern="[0-9]{11}" maxlength="11">
                        <p class="text-xs text-gray-500 mt-1">11 haneli telefon numarası (05XXXXXXXXX)</p>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Şifre *</label>
                        <input type="password" id="registerPassword" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required minlength="6">
                        <p class="text-xs text-gray-500 mt-1">En az 6 karakter</p>
                    </div>
                    <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">
                        Kayıt Ol
                    </button>
                </form>
            </div>
            
            <button id="closeLoginModal" class="mt-4 w-full text-gray-500 hover:text-gray-700">İptal</button>
        </div>
    </div>

    <!-- Add Pet Modal -->
    <div id="addPetModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-3xl font-bold mb-8 text-center">🐾 Yeni Hayvan Profili Oluştur</h3>
            
            <!-- Tab Navigation -->
            <div class="flex mb-8 bg-gray-100 rounded-lg p-1">
                <button type="button" class="tab-button flex-1 py-2 px-4 rounded-md text-sm font-medium active bg-purple-600 text-white" onclick="switchTab('basic')">
                    📝 Temel Bilgiler
                </button>
                <button type="button" class="tab-button flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-600" onclick="switchTab('photos')">
                    📸 Fotoğraflar
                </button>
                <button type="button" class="tab-button flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-600" onclick="switchTab('health')">
                    🏥 Sağlık & Veteriner
                </button>
                <button type="button" class="tab-button flex-1 py-2 px-4 rounded-md text-sm font-medium text-gray-600" onclick="switchTab('social')">
                    🌐 Sosyal Medya
                </button>
            </div>

            <form id="addPetForm">
                <!-- Basic Info Tab -->
                <div id="basicTab" class="tab-content">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Hayvan Adı *</label>
                            <input type="text" name="petName" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required placeholder="Örn: Karamel">
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Tür *</label>
                            <select name="petType" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                                <option value="">Seçiniz</option>
                                <option value="köpek">🐕 Köpek</option>
                                <option value="kedi">🐱 Kedi</option>
                                <option value="kuş">🐦 Kuş</option>
                                <option value="hamster">🐹 Hamster</option>
                                <option value="tavşan">🐰 Tavşan</option>
                                <option value="balık">🐠 Balık</option>
                                <option value="diğer">🐾 Diğer</option>
                            </select>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Cinsi</label>
                            <input type="text" name="breed" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="Örn: Golden Retriever">
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Doğum Tarihi</label>
                            <input type="date" name="birthDate" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Cinsiyet</label>
                            <select name="gender" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500">
                                <option value="">Seçiniz</option>
                                <option value="erkek">♂️ Erkek</option>
                                <option value="dişi">♀️ Dişi</option>
                            </select>
                        </div>
                        <div class="mb-6">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Renk/Desen</label>
                            <input type="text" name="color" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="Örn: Altın sarısı, beyaz göğüslü">
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Genel Açıklama</label>
                        <textarea name="description" rows="4" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="Hayvanınızın karakteri, alışkanlıkları, sevdiği şeyler..."></textarea>
                    </div>
                </div>

                <!-- Photos Tab -->
                <div id="photosTab" class="tab-content hidden">
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Fotoğraf Yükle</label>
                        <div class="photo-upload-area border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer" onclick="document.getElementById('photoInput').click()">
                            <div class="text-4xl mb-4">📸</div>
                            <p class="text-gray-600 mb-2">Fotoğraf yüklemek için tıklayın</p>
                            <p class="text-sm text-gray-500">JPG, PNG, GIF (Max 5MB)</p>
                        </div>
                        <input type="file" id="photoInput" accept="image/*" multiple class="hidden" onchange="handlePhotoUpload(event)">
                    </div>
                    
                    <div id="photoPreview" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- Photo previews will be added here -->
                    </div>
                </div>

                <!-- Health & Vet Tab -->
                <div id="healthTab" class="tab-content hidden">
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Sağlık Durumu</label>
                        <textarea name="health" rows="4" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="Kronik hastalıklar, alerjiler, sürekli kullandığı ilaçlar..."></textarea>
                    </div>

                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Veteriner Bilgileri</label>
                        <div class="grid md:grid-cols-2 gap-4">
                            <input type="text" name="vetName" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="Veteriner adı">
                            <input type="tel" name="vetPhone" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="Veteriner telefonu">
                        </div>
                        <input type="text" name="vetAddress" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 mt-2" placeholder="Veteriner adresi">
                    </div>

                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Acil Durum Talimatları</label>
                        <textarea name="emergencyInstructions" rows="3" class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="Acil durumda yapılması gerekenler, özel talimatlar..."></textarea>
                    </div>
                </div>

                <!-- Social Media Tab -->
                <div id="socialTab" class="tab-content hidden">
                    <div class="space-y-6">
                        <div class="relative">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Instagram</label>
                            <div class="relative">
                                <span class="social-icon">📷</span>
                                <input type="url" name="instagram" class="social-input form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="https://instagram.com/username">
                            </div>
                        </div>
                        
                        <div class="relative">
                            <label class="block text-gray-700 text-sm font-bold mb-2">TikTok</label>
                            <div class="relative">
                                <span class="social-icon">🎵</span>
                                <input type="url" name="tiktok" class="social-input form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="https://tiktok.com/@username">
                            </div>
                        </div>
                        
                        <div class="relative">
                            <label class="block text-gray-700 text-sm font-bold mb-2">YouTube</label>
                            <div class="relative">
                                <span class="social-icon">📺</span>
                                <input type="url" name="youtube" class="social-input form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="https://youtube.com/channel/...">
                            </div>
                        </div>
                        
                        <div class="relative">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Facebook</label>
                            <div class="relative">
                                <span class="social-icon">👥</span>
                                <input type="url" name="facebook" class="social-input form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="https://facebook.com/username">
                            </div>
                        </div>
                        
                        <div class="relative">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Twitter/X</label>
                            <div class="relative">
                                <span class="social-icon">🐦</span>
                                <input type="url" name="twitter" class="social-input form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="https://twitter.com/username">
                            </div>
                        </div>
                        
                        <div class="relative">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Website</label>
                            <div class="relative">
                                <span class="social-icon">🌐</span>
                                <input type="url" name="website" class="social-input form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" placeholder="https://website.com">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Custom Fields Section -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-semibold text-gray-800">📝 Ek Bilgi Kutucukları</h4>
                            <button type="button" onclick="addCustomField()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                + Yeni Kutucuk Ekle
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Özel bilgiler için ek kutucuklar ekleyebilirsiniz (örn: Favori oyuncağı, Korktuğu şeyler, Özel notlar)</p>
                        <div id="customFieldsContainer" class="space-y-4">
                            <!-- Custom fields will be added here -->
                        </div>
                    </div>
                </div>
                
                <div class="flex gap-4 mt-8">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-bold py-3 px-6 rounded-lg text-lg">
                        🐾 Profili Oluştur
                    </button>
                    <button type="button" id="closeAddPetModal" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-3 px-6 rounded-lg text-lg">
                        İptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold mb-6 text-center">👤 Profili Düzenle</h3>
            <form id="editProfileForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ad Soyad</label>
                    <input type="text" id="editName" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Telefon Numarası</label>
                    <input type="tel" id="editPhone" class="form-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-purple-500" required pattern="[0-9]{11}" maxlength="11">
                </div>
                <div class="flex gap-4">
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                        Güncelle
                    </button>
                    <button type="button" id="closeEditProfileModal" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-bold py-2 px-4 rounded-lg">
                        İptal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Pet Details Modal -->
    <div id="petDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div id="petDetailsContent">
                <!-- Pet details content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2">
        <!-- Notifications will be added here -->
    </div>

    <script>
        // Global state
        let currentUser = null;
        let pets = [];
        let currentPet = null;
        let petStats = {};
        let currentTab = 'basic';
        let uploadedPhotos = [];
        let customFields = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Check URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const petId = urlParams.get('pet');
            
            if (petId) {
                showPetProfile(petId);
            }
            
            initializeEventListeners();
            initializeFirebaseAuth();
        });

        // Firebase Authentication
        function initializeFirebaseAuth() {
            const unsubscribe = window.firebaseAuthStateChanged(window.firebaseAuth, async (user) => {
                if (user) {
                    try {
                        await window.firebaseSetPersistence(window.firebaseAuth, window.firebaseBrowserLocalPersistence);
                    } catch (error) {
                        console.log('Persistence already set or failed:', error);
                    }
                    
                    loadUserProfile(user);
                } else {
                    currentUser = null;
                    pets = [];
                    petStats = {};
                    updateNavigation();
                    showWelcomeSection();
                }
            });

            window.authUnsubscribe = unsubscribe;
        }

        async function loadUserProfile(user) {
            try {
                const userDoc = await window.firestoreGetDoc(window.firestoreDoc(window.firebaseDb, 'users', user.uid));
                if (userDoc.exists()) {
                    currentUser = { uid: user.uid, ...userDoc.data() };
                    await loadUserPets();
                    showUserDashboard();
                    updateNavigation();
                } else {
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        name: user.displayName || 'Kullanıcı',
                        phone: '',
                        registrationDate: new Date().toISOString()
                    };
                    await window.firestoreSetDoc(window.firestoreDoc(window.firebaseDb, 'users', user.uid), currentUser);
                    showUserDashboard();
                    updateNavigation();
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
                showNotification('Kullanıcı profili yüklenirken hata oluştu!', 'error');
            }
        }

        async function loadUserPets() {
            try {
                const petsQuery = window.firestoreQuery(
                    window.firestoreCollection(window.firebaseDb, 'pets'),
                    window.firestoreWhere('ownerId', '==', currentUser.uid)
                );
                const petsSnapshot = await window.firestoreGetDocs(petsQuery);
                
                pets = [];
                petStats = {};
                
                petsSnapshot.forEach((doc) => {
                    const petData = { id: doc.id, ...doc.data() };
                    pets.push(petData);
                    petStats[doc.id] = petData.stats || { views: 0, calls: 0, locations: [], visitors: [] };
                });
                
                pets.sort((a, b) => {
                    const dateA = new Date(a.createdAt || 0);
                    const dateB = new Date(b.createdAt || 0);
                    return dateB - dateA;
                });
                
                renderPetsList();
            } catch (error) {
                console.error('Error loading pets:', error);
                showNotification('Hayvan profilleri yüklenirken hata oluştu!', 'error');
            }
        }

        function initializeEventListeners() {
            // Navigation buttons
            document.getElementById('loginBtn').addEventListener('click', function(e) {
                e.preventDefault();
                showModal('loginModal');
            });
            
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            // Modal close buttons
            document.getElementById('closeLoginModal').addEventListener('click', function(e) {
                e.preventDefault();
                hideModal('loginModal');
            });
            
            document.getElementById('closeAddPetModal').addEventListener('click', function(e) {
                e.preventDefault();
                hideModal('addPetModal');
            });
            
            document.getElementById('closeEditProfileModal').addEventListener('click', function(e) {
                e.preventDefault();
                hideModal('editProfileModal');
            });
            
            // Dashboard buttons
            document.getElementById('addPetBtn').addEventListener('click', function(e) {
                e.preventDefault();
                showModal('addPetModal');
            });
            
            document.getElementById('editProfileBtn').addEventListener('click', function(e) {
                e.preventDefault();
                showEditProfileModal();
            });
            
            // Form submissions
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('addPetForm').addEventListener('submit', handleAddPet);
            document.getElementById('editProfileForm').addEventListener('submit', handleEditProfile);
            
            // Close modals on backdrop click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                    }
                });
            });
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification('E-posta ve şifre gerekli!', 'error');
                return;
            }
            
            try {
                await window.firebaseSetPersistence(window.firebaseAuth, window.firebaseBrowserLocalPersistence);
                const userCredential = await window.firebaseSignIn(window.firebaseAuth, email, password);
                
                hideModal('loginModal');
                showNotification('Giriş başarılı!', 'success');
                
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = 'Giriş başarısız!';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Bu e-posta adresi ile kayıtlı kullanıcı bulunamadı!';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Yanlış şifre!';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Geçersiz e-posta adresi!';
                        break;
                    case 'auth/invalid-credential':
                        errorMessage = 'Geçersiz giriş bilgileri!';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                showNotification(errorMessage, 'error');
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const phone = document.getElementById('registerPhone').value.trim();
            const password = document.getElementById('registerPassword').value;
            
            if (!name || !email || !phone || !password) {
                showNotification('Tüm alanlar gerekli!', 'error');
                return;
            }
            
            if (!/^[0-9]{11}$/.test(phone)) {
                showNotification('Telefon numarası 11 haneli olmalı!', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Şifre en az 6 karakter olmalı!', 'error');
                return;
            }
            
            try {
                await window.firebaseSetPersistence(window.firebaseAuth, window.firebaseBrowserLocalPersistence);
                const userCredential = await window.firebaseCreateUser(window.firebaseAuth, email, password);
                
                const userData = {
                    uid: userCredential.user.uid,
                    email: email,
                    name: name,
                    phone: phone,
                    registrationDate: new Date().toISOString()
                };
                
                await window.firestoreSetDoc(window.firestoreDoc(window.firebaseDb, 'users', userCredential.user.uid), userData);
                
                hideModal('loginModal');
                showNotification('Kayıt başarılı! Hoş geldiniz!', 'success');
                
                document.getElementById('registerName').value = '';
                document.getElementById('registerEmail').value = '';
                document.getElementById('registerPhone').value = '';
                document.getElementById('registerPassword').value = '';
                
            } catch (error) {
                console.error('Registration error:', error);
                let errorMessage = 'Kayıt başarısız!';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Bu e-posta adresi zaten kullanımda!';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Geçersiz e-posta adresi!';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Şifre çok zayıf!';
                        break;
                    default:
                        errorMessage = error.message;
                }
                
                showNotification(errorMessage, 'error');
            }
        }

        async function handleAddPet(e) {
            e.preventDefault();
            if (!currentUser) {
                showNotification('Önce giriş yapmalısınız!', 'error');
                return;
            }
            
            const formData = new FormData(e.target);
            
            const petData = {
                name: formData.get('petName'),
                type: formData.get('petType'),
                breed: formData.get('breed') || '',
                birthDate: formData.get('birthDate') || '',
                gender: formData.get('gender') || '',
                color: formData.get('color') || '',
                description: formData.get('description') || '',
                health: formData.get('health') || '',
                vetName: formData.get('vetName') || '',
                vetPhone: formData.get('vetPhone') || '',
                vetAddress: formData.get('vetAddress') || '',
                emergencyInstructions: formData.get('emergencyInstructions') || '',
                instagram: formData.get('instagram') || '',
                tiktok: formData.get('tiktok') || '',
                youtube: formData.get('youtube') || '',
                facebook: formData.get('facebook') || '',
                twitter: formData.get('twitter') || '',
                website: formData.get('website') || '',
                customFields: customFields.filter(field => field.title.trim() && field.content.trim()),
                photos: uploadedPhotos,
                ownerId: currentUser.uid,
                ownerName: currentUser.name,
                ownerEmail: currentUser.email,
                ownerPhone: currentUser.phone,
                createdAt: new Date().toISOString(),
                stats: { views: 0, calls: 0, locations: [], visitors: [] }
            };
            
            try {
                const docRef = await window.firestoreAddDoc(window.firestoreCollection(window.firebaseDb, 'pets'), petData);
                
                const petLink = `${window.location.origin}${window.location.pathname}?pet=${docRef.id}`;
                await window.firestoreUpdateDoc(docRef, { link: petLink });
                
                hideModal('addPetModal');
                showNotification('Hayvan profili başarıyla oluşturuldu!', 'success');
                
                e.target.reset();
                uploadedPhotos = [];
                customFields = [];
                document.getElementById('photoPreview').innerHTML = '';
                document.getElementById('customFieldsContainer').innerHTML = '';
                await loadUserPets();
                
            } catch (error) {
                console.error('Error adding pet:', error);
                showNotification('Hayvan profili oluşturulurken hata oluştu!', 'error');
            }
        }

        async function handleEditProfile(e) {
            e.preventDefault();
            if (!currentUser) return;
            
            const name = document.getElementById('editName').value.trim();
            const phone = document.getElementById('editPhone').value.trim();
            
            if (!name || !phone) {
                showNotification('Tüm alanlar gerekli!', 'error');
                return;
            }
            
            if (!/^[0-9]{11}$/.test(phone)) {
                showNotification('Telefon numarası 11 haneli olmalı!', 'error');
                return;
            }
            
            try {
                const updatedData = { name, phone };
                await window.firestoreUpdateDoc(window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid), updatedData);
                
                currentUser.name = name;
                currentUser.phone = phone;
                
                hideModal('editProfileModal');
                showNotification('Profil başarıyla güncellendi!', 'success');
                updateNavigation();
                
            } catch (error) {
                console.error('Error updating profile:', error);
                showNotification('Profil güncellenirken hata oluştu!', 'error');
            }
        }

        function handlePhotoUpload(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Fotoğraf boyutu 5MB\'dan küçük olmalı!', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photoData = {
                        id: Date.now() + Math.random(),
                        data: e.target.result,
                        name: file.name
                    };
                    
                    uploadedPhotos.push(photoData);
                    renderPhotoPreview();
                };
                reader.readAsDataURL(file);
            });
        }

        function renderPhotoPreview() {
            const photoPreview = document.getElementById('photoPreview');
            photoPreview.innerHTML = '';
            
            uploadedPhotos.forEach(photo => {
                const photoDiv = document.createElement('div');
                photoDiv.className = 'photo-preview relative rounded-lg overflow-hidden';
                photoDiv.innerHTML = `
                    <img src="${photo.data}" alt="${photo.name}" class="w-full h-32 object-cover">
                    <button type="button" class="delete-photo" onclick="removePhoto('${photo.id}')">×</button>
                `;
                photoPreview.appendChild(photoDiv);
            });
        }

        function removePhoto(photoId) {
            uploadedPhotos = uploadedPhotos.filter(photo => photo.id !== photoId);
            renderPhotoPreview();
        }

        function addCustomField() {
            const fieldId = Date.now() + Math.random();
            const customField = {
                id: fieldId,
                title: '',
                content: '',
                icon: '📝'
            };
            
            customFields.push(customField);
            renderCustomFields();
        }

        function removeCustomField(fieldId) {
            customFields = customFields.filter(field => field.id !== fieldId);
            renderCustomFields();
        }

        function renderCustomFields() {
            const container = document.getElementById('customFieldsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            customFields.forEach(field => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'bg-gray-50 border border-gray-200 rounded-lg p-4';
                fieldDiv.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center gap-2">
                            <select onchange="updateCustomFieldIcon('${field.id}', this.value)" class="text-lg bg-transparent border-none outline-none cursor-pointer">
                                <option value="📝" ${field.icon === '📝' ? 'selected' : ''}>📝</option>
                                <option value="🎾" ${field.icon === '🎾' ? 'selected' : ''}>🎾</option>
                                <option value="❤️" ${field.icon === '❤️' ? 'selected' : ''}>❤️</option>
                                <option value="😨" ${field.icon === '😨' ? 'selected' : ''}>😨</option>
                                <option value="🍖" ${field.icon === '🍖' ? 'selected' : ''}>🍖</option>
                                <option value="🏠" ${field.icon === '🏠' ? 'selected' : ''}>🏠</option>
                                <option value="⭐" ${field.icon === '⭐' ? 'selected' : ''}>⭐</option>
                                <option value="🎵" ${field.icon === '🎵' ? 'selected' : ''}>🎵</option>
                                <option value="🌟" ${field.icon === '🌟' ? 'selected' : ''}>🌟</option>
                                <option value="💊" ${field.icon === '💊' ? 'selected' : ''}>💊</option>
                                <option value="🎯" ${field.icon === '🎯' ? 'selected' : ''}>🎯</option>
                                <option value="📍" ${field.icon === '📍' ? 'selected' : ''}>📍</option>
                            </select>
                            <input type="text" placeholder="Kutucuk başlığı (örn: Favori Oyuncağı)" value="${field.title}" onchange="updateCustomFieldTitle('${field.id}', this.value)" class="font-medium text-gray-800 bg-transparent border-none outline-none flex-1 placeholder-gray-400">
                        </div>
                        <button type="button" onclick="removeCustomField('${field.id}')" class="text-red-500 hover:text-red-700 text-lg">×</button>
                    </div>
                    <textarea placeholder="İçerik yazın..." onchange="updateCustomFieldContent('${field.id}', this.value)" class="w-full bg-white border border-gray-300 rounded-lg px-3 py-2 text-gray-700 placeholder-gray-400 resize-none" rows="3">${field.content}</textarea>
                `;
                container.appendChild(fieldDiv);
            });
        }

        function updateCustomFieldIcon(fieldId, icon) {
            const field = customFields.find(f => f.id == fieldId);
            if (field) {
                field.icon = icon;
            }
        }

        function updateCustomFieldTitle(fieldId, title) {
            const field = customFields.find(f => f.id == fieldId);
            if (field) {
                field.title = title;
            }
        }

        function updateCustomFieldContent(fieldId, content) {
            const field = customFields.find(f => f.id == fieldId);
            if (field) {
                field.content = content;
            }
        }

        async function logout() {
            try {
                await window.firebaseSignOut(window.firebaseAuth);
                
                currentUser = null;
                pets = [];
                petStats = {};
                
                updateNavigation();
                showWelcomeSection();
                
                showNotification('Güvenli çıkış yapıldı!', 'success');
                
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Çıkış yapılırken hata oluştu: ' + error.message, 'error');
                
                currentUser = null;
                pets = [];
                petStats = {};
                updateNavigation();
                showWelcomeSection();
            }
        }

        function updateNavigation() {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (currentUser) {
                loginBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                logoutBtn.textContent = `Çıkış (${currentUser.name})`;
            } else {
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
            }
        }

        function showWelcomeSection() {
            document.getElementById('welcomeSection').classList.remove('hidden');
            document.getElementById('userDashboard').classList.add('hidden');
            document.getElementById('petProfileView').classList.add('hidden');
        }

        function showUserDashboard() {
            document.getElementById('welcomeSection').classList.add('hidden');
            document.getElementById('userDashboard').classList.remove('hidden');
            document.getElementById('petProfileView').classList.add('hidden');
            renderPetsList();
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function showEditProfileModal() {
            if (!currentUser) return;
            
            document.getElementById('editName').value = currentUser.name || '';
            document.getElementById('editPhone').value = currentUser.phone || '';
            showModal('editProfileModal');
        }

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('bg-purple-600', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            // Show selected tab content
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Add active class to clicked button
            event.target.classList.add('active', 'bg-purple-600', 'text-white');
            event.target.classList.remove('text-gray-600');
            
            currentTab = tabName;
        }

        function switchLoginTab(tabName) {
            const loginFormDiv = document.getElementById('loginFormDiv');
            const registerFormDiv = document.getElementById('registerFormDiv');
            const loginTabBtn = document.getElementById('loginTabBtn');
            const registerTabBtn = document.getElementById('registerTabBtn');
            
            if (tabName === 'login') {
                loginFormDiv.classList.remove('hidden');
                registerFormDiv.classList.add('hidden');
                loginTabBtn.classList.add('bg-purple-600', 'text-white');
                loginTabBtn.classList.remove('text-gray-600');
                registerTabBtn.classList.remove('bg-purple-600', 'text-white');
                registerTabBtn.classList.add('text-gray-600');
            } else {
                loginFormDiv.classList.add('hidden');
                registerFormDiv.classList.remove('hidden');
                registerTabBtn.classList.add('bg-purple-600', 'text-white');
                registerTabBtn.classList.remove('text-gray-600');
                loginTabBtn.classList.remove('bg-purple-600', 'text-white');
                loginTabBtn.classList.add('text-gray-600');
            }
        }

        function renderPetsList() {
            const petsList = document.getElementById('petsList');
            if (!petsList) return;
            
            petsList.innerHTML = '';
            
            if (pets.length === 0) {
                petsList.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <div class="text-6xl mb-4">🐾</div>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Henüz hayvan profili yok</h3>
                        <p class="text-gray-500 mb-6">İlk hayvan profilinizi oluşturun!</p>
                        <button onclick="showModal('addPetModal')" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium">
                            + İlk Profilimi Oluştur
                        </button>
                    </div>
                `;
                return;
            }
            
            pets.forEach(pet => {
                const stats = petStats[pet.id] || { views: 0, calls: 0 };
                const petCard = document.createElement('div');
                petCard.className = 'pet-card bg-white rounded-xl shadow-lg p-6';
                petCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-900">${pet.name}</h3>
                        <button onclick="showPetDetails('${pet.id}')" class="text-purple-600 hover:text-purple-800">
                            ⚙️
                        </button>
                    </div>
                    
                    <div class="mb-4">
                        <p class="text-gray-600">${pet.type} ${pet.breed ? `- ${pet.breed}` : ''}</p>
                        <p class="text-sm text-gray-500">${pet.gender || ''} ${pet.color ? `• ${pet.color}` : ''}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600">${stats.views}</div>
                            <div class="text-sm text-gray-600">Görüntülenme</div>
                        </div>
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600">${stats.calls}</div>
                            <div class="text-sm text-gray-600">Arama</div>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <button onclick="window.open('${pet.link}', '_blank')" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg text-sm">
                            🔗 Profili Görüntüle
                        </button>
                        <button onclick="copyLink('${pet.link}')" class="w-full bg-gray-600 hover:bg-gray-700 text-white py-2 rounded-lg text-sm">
                            📋 Linki Kopyala
                        </button>
                        <button onclick="generateQRCode('${pet.link}', '${pet.name}')" class="w-full bg-orange-600 hover:bg-orange-700 text-white py-2 rounded-lg text-sm">
                            📱 QR Kod Oluştur
                        </button>
                    </div>
                `;
                petsList.appendChild(petCard);
            });
        }

        function showPetDetails(petId) {
            const pet = pets.find(p => p.id === petId);
            if (!pet) return;
            
            const stats = petStats[petId] || { views: 0, calls: 0, locations: [], visitors: [] };
            
            const petDetailsContent = document.getElementById('petDetailsContent');
            petDetailsContent.innerHTML = `
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">🐾 ${pet.name} - Detaylar</h3>
                    <button onclick="hideModal('petDetailsModal')" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                </div>
                
                <!-- Statistics -->
                <div class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-blue-600">${stats.views}</div>
                        <div class="text-sm text-gray-600">Görüntülenme</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-green-600">${stats.calls}</div>
                        <div class="text-sm text-gray-600">Arama</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-purple-600">${stats.locations?.length || 0}</div>
                        <div class="text-sm text-gray-600">Konum Bildirimi</div>
                    </div>
                    <div class="bg-orange-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-orange-600">${stats.visitors?.length || 0}</div>
                        <div class="text-sm text-gray-600">Ziyaretçi</div>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <button onclick="window.open('${pet.link}', '_blank')" class="bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg">
                        🔗 Profili Görüntüle
                    </button>
                    <button onclick="copyLink('${pet.link}')" class="bg-gray-600 hover:bg-gray-700 text-white py-3 px-4 rounded-lg">
                        📋 Linki Kopyala
                    </button>
                    <button onclick="generateQRCode('${pet.link}', '${pet.name}')" class="bg-orange-600 hover:bg-orange-700 text-white py-3 px-4 rounded-lg">
                        📱 QR Kod Oluştur
                    </button>
                </div>
                
                <!-- Recent Locations -->
                ${stats.locations && stats.locations.length > 0 ? `
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                    <h4 class="font-semibold text-red-800 mb-3">📍 Son Konum Bildirimleri</h4>
                    <div class="space-y-3">
                        ${stats.locations.slice(-5).reverse().map(location => `
                            <div class="bg-white rounded-lg p-3 border border-red-100">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-red-800">${location.address || `Lat: ${location.latitude.toFixed(6)}, Lng: ${location.longitude.toFixed(6)}`}</p>
                                        <p class="text-xs text-red-600 mt-1">
                                            ${new Date(location.timestamp).toLocaleString('tr-TR')}
                                            ${location.accuracy ? ` • Doğruluk: ±${Math.round(location.accuracy)}m` : ''}
                                        </p>
                                    </div>
                                    <div class="ml-2 relative">
                                        <button onclick="toggleMapOptions(this)" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs">
                                            🗺️ Harita ▼
                                        </button>
                                        <div class="map-options hidden absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[140px]">
                                            <button onclick="openInGoogleMaps(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-t-lg">
                                                🌍 Google Maps
                                            </button>
                                            <button onclick="openInAppleMaps(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                🍎 Apple Maps
                                            </button>
                                            <button onclick="openInOpenStreetMap(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                🗺️ OpenStreetMap
                                            </button>
                                            <button onclick="openInYandexMaps(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                🔍 Yandex Maps
                                            </button>
                                            <button onclick="openInBingMaps(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-b-lg">
                                                🔷 Bing Maps
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    ${stats.locations.length > 5 ? `
                    <div class="text-center mt-3">
                        <button onclick="showAllLocations('${petId}')" class="text-red-600 hover:text-red-800 text-sm font-medium">
                            Tüm Konumları Göster (${stats.locations.length})
                        </button>
                    </div>
                    ` : ''}
                </div>
                ` : ''}
                
                <!-- Recent Visitors -->
                ${stats.visitors && stats.visitors.length > 0 ? `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-semibold text-blue-800 mb-3">👥 Son Ziyaretçiler</h4>
                    <div class="space-y-2">
                        ${stats.visitors.slice(-10).reverse().map(visitor => `
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-blue-700">${visitor.city || 'Bilinmiyor'}, ${visitor.country || 'Bilinmiyor'}</span>
                                <span class="text-blue-600">${new Date(visitor.timestamp).toLocaleString('tr-TR')}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
            
            showModal('petDetailsModal');
        }

        async function showPetProfile(petId) {
            try {
                const petDoc = await window.firestoreGetDoc(window.firestoreDoc(window.firebaseDb, 'pets', petId));
                
                if (!petDoc.exists()) {
                    showNotification('Hayvan profili bulunamadı!', 'error');
                    return;
                }
                
                const pet = { id: petDoc.id, ...petDoc.data() };
                currentPet = pet;
                
                await updatePetStats(petId);
                
                document.getElementById('welcomeSection').classList.add('hidden');
                document.getElementById('userDashboard').classList.add('hidden');
                document.getElementById('petProfileView').classList.remove('hidden');
                
                renderPetProfile(pet);
                
            } catch (error) {
                console.error('Error loading pet profile:', error);
                showNotification('Hayvan profili yüklenirken hata oluştu!', 'error');
            }
        }

        async function updatePetStats(petId) {
            try {
                const visitorInfo = await getVisitorInfo();
                
                const petDoc = await window.firestoreGetDoc(window.firestoreDoc(window.firebaseDb, 'pets', petId));
                const currentStats = petDoc.data().stats || { views: 0, calls: 0, locations: [], visitors: [] };
                
                const updatedStats = {
                    ...currentStats,
                    views: (currentStats.views || 0) + 1,
                    visitors: [...(currentStats.visitors || []), visitorInfo]
                };
                
                await window.firestoreUpdateDoc(window.firestoreDoc(window.firebaseDb, 'pets', petId), {
                    stats: updatedStats
                });
                
            } catch (error) {
                console.error('Error updating pet stats:', error);
            }
        }

        async function getVisitorInfo() {
            try {
                const response = await fetch('https://api.ipgeolocation.io/ipgeo?apiKey=b647e2a9739c445984120017ef0a3884');
                const data = await response.json();
                return {
                    ip: data.ip,
                    city: data.city,
                    country: data.country_name,
                    isp: data.isp,
                    timestamp: new Date().toISOString()
                };
            } catch (error) {
                return {
                    ip: 'Unknown',
                    city: 'Unknown',
                    country: 'Unknown',
                    isp: 'Unknown',
                    timestamp: new Date().toISOString()
                };
            }
        }

        async function getAddressFromCoordinates(lat, lng) {
            const apis = [
                // API 1: LocationIQ (Free tier: 5000 requests/day)
                {
                    url: `https://us1.locationiq.com/v1/reverse.php?key=pk.0123456789abcdef&lat=${lat}&lon=${lng}&format=json&accept-language=tr`,
                    parser: (data) => data.display_name
                },
                // API 2: Nominatim with different user agent
                {
                    url: `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=tr&addressdetails=1`,
                    parser: (data) => data.display_name,
                    headers: {
                        'User-Agent': 'PatiLink/1.0 (https://patilink.com)'
                    }
                },
                // API 3: MapBox (requires token but has free tier)
                {
                    url: `https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?access_token=pk.eyJ1IjoicGF0aWxpbmsiLCJhIjoiY2x0ZXN0MTIzIn0.example&language=tr`,
                    parser: (data) => data.features && data.features[0] ? data.features[0].place_name : null
                },
                // API 4: BigDataCloud (Free tier)
                {
                    url: `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lng}&localityLanguage=tr`,
                    parser: (data) => {
                        if (data.locality && data.countryName) {
                            return `${data.locality}, ${data.principalSubdivision || ''}, ${data.countryName}`.replace(', ,', ',');
                        }
                        return null;
                    }
                },
                // API 5: OpenCage (Free tier: 2500 requests/day)
                {
                    url: `https://api.opencagedata.com/geocode/v1/json?q=${lat}+${lng}&key=demo-key&language=tr&pretty=1`,
                    parser: (data) => data.results && data.results[0] ? data.results[0].formatted : null
                }
            ];

            for (let i = 0; i < apis.length; i++) {
                try {
                    const api = apis[i];
                    const options = {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            ...api.headers
                        }
                    };

                    const response = await fetch(api.url, options);
                    
                    if (!response.ok) {
                        console.log(`API ${i + 1} failed with status:`, response.status);
                        continue;
                    }

                    const data = await response.json();
                    const address = api.parser(data);
                    
                    if (address && address.trim()) {
                        console.log(`Address found using API ${i + 1}:`, address);
                        return address;
                    }
                } catch (error) {
                    console.log(`API ${i + 1} error:`, error.message);
                    continue;
                }
                
                // Add delay between API calls to avoid rate limiting
                if (i < apis.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
            }

            // If all APIs fail, return coordinates
            return `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
        }

        function renderPetProfile(pet) {
            const petProfileContent = document.getElementById('petProfileContent');
            
            petProfileContent.innerHTML = `
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                    <!-- Header -->
                    <div class="gradient-bg text-white p-8 text-center">
                        <h1 class="text-4xl font-bold mb-2">${pet.name}</h1>
                        <p class="text-xl opacity-90">${pet.type} ${pet.breed ? `• ${pet.breed}` : ''}</p>
                        ${pet.gender || pet.color ? `<p class="opacity-80">${pet.gender || ''} ${pet.color ? `• ${pet.color}` : ''}</p>` : ''}
                    </div>
                    
                    <!-- Photo Gallery -->
                    ${pet.photos && pet.photos.length > 0 ? `
                    <div class="p-6 bg-gray-50 border-b">
                        <h3 class="text-xl font-semibold mb-4">📸 Fotoğraflar</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            ${pet.photos.map(photo => `
                                <div class="rounded-lg overflow-hidden shadow-md">
                                    <img src="${photo.data}" alt="${photo.name}" class="w-full h-32 object-cover hover:scale-105 transition-transform cursor-pointer" onclick="openPhotoModal('${photo.data}')">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Contact Buttons -->
                    <div class="p-6 bg-gray-50 border-b">
                        <div class="grid md:grid-cols-2 gap-4">
                            <button onclick="callOwner('${pet.ownerPhone}')" class="call-button text-white py-4 px-6 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all">
                                📞 Sahibini Ara: ${pet.ownerPhone}
                            </button>
                            <button onclick="sendLocation('${pet.id}')" class="emergency-button text-white py-4 px-6 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all">
                                📍 Konumumu Gönder
                            </button>
                        </div>
                    </div>
                    
                    <!-- Pet Information -->
                    <div class="p-8">
                        <!-- Basic Info -->
                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                            ${pet.birthDate ? `
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-blue-800 mb-1">🎂 Doğum Tarihi</h3>
                                <p class="text-blue-700">${new Date(pet.birthDate).toLocaleDateString('tr-TR')}</p>
                            </div>
                            ` : ''}
                            ${pet.gender ? `
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-purple-800 mb-1">⚧ Cinsiyet</h3>
                                <p class="text-purple-700">${pet.gender}</p>
                            </div>
                            ` : ''}
                            ${pet.color ? `
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-yellow-800 mb-1">🎨 Renk/Desen</h3>
                                <p class="text-yellow-700">${pet.color}</p>
                            </div>
                            ` : ''}
                        </div>
                        
                        <!-- Description -->
                        ${pet.description ? `
                        <div class="bg-gray-50 rounded-lg p-6 mb-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-3">📝 Hakkında</h3>
                            <p class="text-gray-700 leading-relaxed">${pet.description}</p>
                        </div>
                        ` : ''}
                        
                        <!-- Health Information -->
                        ${pet.health ? `
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                            <h3 class="text-lg font-semibold text-red-800 mb-2">🏥 Sağlık Durumu</h3>
                            <p class="text-red-700">${pet.health}</p>
                        </div>
                        ` : ''}

                        <!-- Veterinary Information -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
                            <h3 class="text-xl font-semibold text-blue-800 mb-4">🩺 Veteriner Bilgileri</h3>
                            ${pet.vetName ? `<p class="text-blue-700 mb-3"><strong>Veteriner Adı:</strong> ${pet.vetName}</p>` : `<p class="text-blue-700 mb-3"><strong>Veteriner Adı:</strong> Belirtilmemiş</p>`}
                            ${pet.vetPhone ? `
                            <p class="text-blue-700 mb-3">
                                <strong>Veteriner Telefon:</strong> 
                                <button onclick="window.open('tel:${pet.vetPhone}', '_blank')" class="call-button text-white px-3 py-1 rounded-lg ml-2 hover:opacity-90 cursor-pointer">
                                    📞 ${pet.vetPhone}
                                </button>
                            </p>
                            ` : `<p class="text-blue-700 mb-3"><strong>Veteriner Telefon:</strong> Belirtilmemiş</p>`}
                            ${pet.vetAddress ? `<p class="text-blue-700 mb-3"><strong>Veteriner Adresi:</strong> ${pet.vetAddress}</p>` : `<p class="text-blue-700 mb-3"><strong>Veteriner Adresi:</strong> Belirtilmemiş</p>`}
                        </div>

                        ${pet.emergencyInstructions ? `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                            <h3 class="text-lg font-semibold text-yellow-800 mb-2">⚠️ Acil Durum Talimatları</h3>
                            <p class="text-yellow-700">${pet.emergencyInstructions}</p>
                        </div>
                        ` : ''}

                        <!-- Custom Fields -->
                        ${pet.customFields && pet.customFields.length > 0 ? `
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            ${pet.customFields.map(field => `
                                <div class="bg-gradient-to-br from-indigo-50 to-purple-50 border border-indigo-200 rounded-lg p-4">
                                    <h3 class="text-lg font-semibold text-indigo-800 mb-2 flex items-center gap-2">
                                        <span class="text-xl">${field.icon}</span>
                                        ${field.title}
                                    </h3>
                                    <p class="text-indigo-700 leading-relaxed">${field.content}</p>
                                </div>
                            `).join('')}
                        </div>
                        ` : ''}

                        <!-- Social Media Links -->
                        ${(pet.instagram || pet.tiktok || pet.youtube || pet.facebook || pet.twitter || pet.website) ? `
                        <div class="bg-gradient-to-r from-pink-50 to-purple-50 border border-purple-200 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-purple-800 mb-4">🌐 Sosyal Medya</h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                ${pet.instagram ? `<a href="${pet.instagram}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center bg-gradient-to-r from-purple-500 to-pink-500 text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">📷 Instagram</a>` : ''}
                                ${pet.tiktok ? `<a href="${pet.tiktok}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center bg-black text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">🎵 TikTok</a>` : ''}
                                ${pet.youtube ? `<a href="${pet.youtube}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center bg-red-600 text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">📺 YouTube</a>` : ''}
                                ${pet.facebook ? `<a href="${pet.facebook}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center bg-blue-600 text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">👥 Facebook</a>` : ''}
                                ${pet.twitter ? `<a href="${pet.twitter}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center bg-blue-400 text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">🐦 Twitter</a>` : ''}
                                ${pet.website ? `<a href="${pet.website}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center bg-gray-600 text-white py-2 px-4 rounded-lg hover:opacity-90 transition-opacity">🌐 Website</a>` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function callOwner(phone) {
            window.open(`tel:${phone}`, '_blank');
        }

        function sendLocation(petId) {
            if (navigator.geolocation) {
                // Show loading notification
                showNotification('Konum alınıyor...', 'info');
                
                navigator.geolocation.getCurrentPosition(async (position) => {
                    try {
                        const locationData = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: new Date().toISOString(),
                            address: 'Adres alınıyor...'
                        };
                        
                        // Get address from coordinates using multiple fallback APIs
                        try {
                            locationData.address = await getAddressFromCoordinates(locationData.latitude, locationData.longitude);
                        } catch (addressError) {
                            console.log('Address lookup failed:', addressError);
                            locationData.address = `${locationData.latitude.toFixed(6)}, ${locationData.longitude.toFixed(6)}`;
                        }
                        
                        const petDoc = await window.firestoreGetDoc(window.firestoreDoc(window.firebaseDb, 'pets', petId));
                        const currentStats = petDoc.data().stats || { views: 0, calls: 0, locations: [], visitors: [] };
                        
                        const updatedStats = {
                            ...currentStats,
                            locations: [...(currentStats.locations || []), locationData]
                        };
                        
                        await window.firestoreUpdateDoc(window.firestoreDoc(window.firebaseDb, 'pets', petId), {
                            stats: updatedStats
                        });
                        
                        // Show success with location details
                        showLocationConfirmation(locationData);
                        
                    } catch (error) {
                        console.error('Error sending location:', error);
                        showNotification('Konum gönderilirken hata oluştu!', 'error');
                    }
                }, (error) => {
                    let errorMessage = 'Konum alınamadı. ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Konum izni verilmedi.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Konum bilgisi mevcut değil.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Konum alma zaman aşımına uğradı.';
                            break;
                        default:
                            errorMessage += 'Bilinmeyen hata.';
                            break;
                    }
                    showNotification(errorMessage, 'error');
                }, {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                });
            } else {
                showNotification('Tarayıcınız konum özelliğini desteklemiyor.', 'error');
            }
        }

        function showLocationConfirmation(locationData) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-4">✅</div>
                        <h3 class="text-2xl font-bold text-green-600 mb-2">Konum Başarıyla Gönderildi!</h3>
                        <p class="text-gray-600">Hayvan sahibi konumunuzu görebilecek.</p>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                        <h4 class="font-semibold mb-2">📍 Gönderilen Konum:</h4>
                        <p class="text-sm text-gray-700 mb-2">${locationData.address}</p>
                        <p class="text-xs text-gray-500">
                            Koordinatlar: ${locationData.latitude.toFixed(6)}, ${locationData.longitude.toFixed(6)}
                        </p>
                        <p class="text-xs text-gray-500">
                            Doğruluk: ±${Math.round(locationData.accuracy)}m
                        </p>
                    </div>
                    
                    <div class="flex gap-3">
                        <div class="flex-1 relative">
                            <button onclick="toggleMapOptions(this)" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm">
                                🗺️ Haritada Göster ▼
                            </button>
                            <div class="map-options hidden absolute left-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 w-full">
                                <button onclick="openInGoogleMaps(${locationData.latitude}, ${locationData.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-t-lg">
                                    🌍 Google Maps
                                </button>
                                <button onclick="openInAppleMaps(${locationData.latitude}, ${locationData.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    🍎 Apple Maps
                                </button>
                                <button onclick="openInOpenStreetMap(${locationData.latitude}, ${locationData.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    🗺️ OpenStreetMap
                                </button>
                                <button onclick="openInYandexMaps(${locationData.latitude}, ${locationData.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    🔍 Yandex Maps
                                </button>
                                <button onclick="openInBingMaps(${locationData.latitude}, ${locationData.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-b-lg">
                                    🔷 Bing Maps
                                </button>
                            </div>
                        </div>
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg text-sm">
                            Kapat
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Auto close after 10 seconds
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    modal.remove();
                }
            }, 10000);
        }

        function toggleMapOptions(button) {
            const mapOptions = button.nextElementSibling;
            const allMapOptions = document.querySelectorAll('.map-options');
            
            // Close all other map options
            allMapOptions.forEach(option => {
                if (option !== mapOptions) {
                    option.classList.add('hidden');
                }
            });
            
            // Toggle current map options
            mapOptions.classList.toggle('hidden');
            
            // Close when clicking outside
            if (!mapOptions.classList.contains('hidden')) {
                setTimeout(() => {
                    document.addEventListener('click', function closeMapOptions(e) {
                        if (!button.contains(e.target) && !mapOptions.contains(e.target)) {
                            mapOptions.classList.add('hidden');
                            document.removeEventListener('click', closeMapOptions);
                        }
                    });
                }, 100);
            }
        }

        function openInGoogleMaps(lat, lng) {
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // Mobile - try app first, then web
                window.open(`comgooglemaps://?q=${lat},${lng}&center=${lat},${lng}&zoom=16`, '_blank');
                setTimeout(() => {
                    window.open(`https://maps.google.com/maps?q=${lat},${lng}&ll=${lat},${lng}&z=16`, '_blank');
                }, 1000);
            } else {
                // Desktop
                window.open(`https://maps.google.com/maps?q=${lat},${lng}&ll=${lat},${lng}&z=16`, '_blank');
            }
        }

        function openInAppleMaps(lat, lng) {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            
            if (isIOS) {
                // iOS - try app first
                window.open(`maps://maps.apple.com/?q=${lat},${lng}&ll=${lat},${lng}&z=16`, '_blank');
                setTimeout(() => {
                    window.open(`https://maps.apple.com/?q=${lat},${lng}`, '_blank');
                }, 1000);
            } else {
                // Non-iOS devices
                window.open(`https://maps.apple.com/?q=${lat},${lng}`, '_blank');
            }
        }

        function openInOpenStreetMap(lat, lng) {
            window.open(`https://www.openstreetmap.org/?mlat=${lat}&mlon=${lng}&zoom=16#map=16/${lat}/${lng}`, '_blank');
        }

        function openInYandexMaps(lat, lng) {
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // Mobile - try app first
                window.open(`yandexmaps://maps.yandex.com/?pt=${lng},${lat}&z=16&l=map`, '_blank');
                setTimeout(() => {
                    window.open(`https://yandex.com.tr/harita/?pt=${lng},${lat}&z=16&l=map`, '_blank');
                }, 1000);
            } else {
                // Desktop
                window.open(`https://yandex.com.tr/harita/?pt=${lng},${lat}&z=16&l=map`, '_blank');
            }
        }

        function openInBingMaps(lat, lng) {
            window.open(`https://www.bing.com/maps?cp=${lat}~${lng}&lvl=16&style=r`, '_blank');
        }

        // Legacy function for backward compatibility
        function openInMaps(lat, lng) {
            openInGoogleMaps(lat, lng);
        }

        function copyLink(link) {
            navigator.clipboard.writeText(link).then(() => {
                showNotification('Link kopyalandı!', 'success');
            }).catch(() => {
                showNotification('Link kopyalanamadı!', 'error');
            });
        }

        function generateQRCode(link, petName) {
            const qrModal = document.createElement('div');
            qrModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            qrModal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4 text-center">
                    <h3 class="text-2xl font-bold mb-6">${petName} - QR Kod</h3>
                    <div class="qr-code mb-6" id="qrCodeContainer"></div>
                    <p class="text-gray-600 mb-4">Bu QR kodu taratarak ${petName}'in profiline ulaşabilirsiniz</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg">
                        Kapat
                    </button>
                </div>
            `;
            
            document.body.appendChild(qrModal);
            
            // Generate QR code using a simple method
            const qrContainer = document.getElementById('qrCodeContainer');
            const qrSize = 200;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encodeURIComponent(link)}`;
            qrContainer.innerHTML = `<img src="${qrUrl}" alt="QR Code" class="mx-auto">`;
        }

        function showAllLocations(petId) {
            const pet = pets.find(p => p.id === petId);
            if (!pet) return;
            
            const stats = petStats[petId] || { locations: [] };
            const locations = stats.locations || [];
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold">📍 ${pet.name} - Tüm Konum Bildirimleri</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl">×</button>
                    </div>
                    
                    <div class="space-y-3">
                        ${locations.slice().reverse().map((location, index) => `
                            <div class="bg-gray-50 rounded-lg p-4 border">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full font-medium">
                                                #${locations.length - index}
                                            </span>
                                            <span class="text-sm font-medium text-gray-800">
                                                ${new Date(location.timestamp).toLocaleString('tr-TR')}
                                            </span>
                                        </div>
                                        <p class="text-gray-700 mb-1">${location.address || 'Adres bilgisi yok'}</p>
                                        <p class="text-xs text-gray-500">
                                            Koordinatlar: ${location.latitude.toFixed(6)}, ${location.longitude.toFixed(6)}
                                            ${location.accuracy ? ` • Doğruluk: ±${Math.round(location.accuracy)}m` : ''}
                                        </p>
                                    </div>
                                    <div class="flex gap-2 ml-4">
                                        <div class="relative">
                                            <button onclick="toggleMapOptions(this)" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                                🗺️ Harita ▼
                                            </button>
                                            <div class="map-options hidden absolute right-0 top-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[140px]">
                                                <button onclick="openInGoogleMaps(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-t-lg">
                                                    🌍 Google Maps
                                                </button>
                                                <button onclick="openInAppleMaps(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                    🍎 Apple Maps
                                                </button>
                                                <button onclick="openInOpenStreetMap(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                    🗺️ OpenStreetMap
                                                </button>
                                                <button onclick="openInYandexMaps(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                                    🔍 Yandex Maps
                                                </button>
                                                <button onclick="openInBingMaps(${location.latitude}, ${location.longitude})" class="block w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-b-lg">
                                                    🔷 Bing Maps
                                                </button>
                                            </div>
                                        </div>
                                        <button onclick="copyLocation(${location.latitude}, ${location.longitude})" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded text-sm">
                                            📋 Kopyala
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${locations.length === 0 ? `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">📍</div>
                        <h4 class="text-xl font-semibold text-gray-600 mb-2">Henüz konum bildirimi yok</h4>
                        <p class="text-gray-500">Hayvanınızı bulan kişiler konum gönderdiğinde burada görünecek.</p>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function copyLocation(lat, lng) {
            const locationText = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            navigator.clipboard.writeText(locationText).then(() => {
                showNotification('Konum koordinatları kopyalandı!', 'success');
            }).catch(() => {
                showNotification('Konum kopyalanamadı!', 'error');
            });
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            
            notification.className = `notification ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg max-w-sm`;
            notification.textContent = message;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98f024d2f532e00b',t:'MTc2MDUzOTk4NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

